{% extends 'base-tutoring-zone.html' %}

{% block navbar %}
{% include 'tutoring-zone/nav-no-search.html' %}
{% endblock navbar %}

{% load static %}

{% block content %}
<main class="auth layout">
  <div class="container">
    <div class="layout__box">
      <div class="layout__boxHeader">
        <div class="layout__boxTitle">
          <h3 id="form-title">Rejestracja</h3>
        </div>
      </div>
      <div class="layout__body">
        <h2 class="auth__tagline" id="form-tagline">
          Wybierz rolę, aby rozpocząć rejestrację w <i>Strefie Korepetycji</i>
        </h2>

        <form class="form" action="" method="POST">
          {% csrf_token %}

          <div class="form__group role-selection">
            <input type="hidden" name="role" id="role-input" value="{{ form.data.role|default:'' }}">
            <button type="button" class="role-btn" data-role="student" onclick="selectRole('student')">
                <img src="{% static 'img/widget/main-view-7.webp' %}" alt="Uczeń">
                Uczeń
            </button>
            <button type="button" class="role-btn" data-role="teacher" onclick="selectRole('teacher')">
                <img src="{% static 'img/widget/main-view-2.webp' %}" alt="Korepetytor">
                Korepetytor
            </button>
          </div>

          <div id="form-fields" class="{% if form.errors %}{% else %}hidden{% endif %}" style="{% if form.errors %}display: block;{% endif %}">
            <div class="form__group">
              <input
                type="text"
                name="first_name"
                id="{{ form.first_name.id_for_label }}"
                class="form-control"
                placeholder="{{ form.first_name.label }}"
                value="{{ form.first_name.value|default_if_none:'' }}"
                required
              >
              {% if form.first_name.errors %}
                <ul class="messages">
                  {% for error in form.first_name.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <input
                type="text"
                name="last_name"
                id="{{ form.last_name.id_for_label }}"
                class="form-control"
                placeholder="{{ form.last_name.label }}"
                value="{{ form.last_name.value|default_if_none:'' }}"
                required
              >
              {% if form.last_name.errors %}
                <ul class="messages">
                  {% for error in form.last_name.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <input
                type="text"
                name="username"
                id="{{ form.username.id_for_label }}"
                class="form-control"
                placeholder="{{ form.username.label }}"
                value="{{ form.username.value|default_if_none:'' }}"
                required
              >
              {% if form.username.errors %}
                <ul class="messages">
                  {% for error in form.username.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <input
                type="email"
                name="email"
                id="{{ form.email.id_for_label }}"
                class="form-control"
                placeholder="{{ form.email.label }}"
                value="{{ form.email.value|default_if_none:'' }}"
                required
              >
              {% if form.email.errors %}
                <ul class="messages">
                  {% for error in form.email.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <input
                type="text"
                name="phone_number"
                id="{{ form.phone_number.id_for_label }}"
                class="form-control"
                placeholder="{{ form.phone_number.label }}"
                value="{{ form.phone_number.value|default_if_none:'' }}"
              >
              {% if form.phone_number.errors %}
                <ul class="messages">
                  {% for error in form.phone_number.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group" id="subject-group">
                <label for="{{ form.subject.id_for_label }}" id="subject-label">{{ form.subject.label }}</label>
                {{ form.subject }}
                {% if form.subject.errors %}
                  <ul class="messages">
                    {% for error in form.subject.errors %}
                      <li class="error">{{ error }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}
            </div>

            <div class="form__group">
                <label for="{{ form.level.id_for_label }}">Poziom nauki</label>
                {{ form.level }}
                {% if form.level.errors %}
                  <ul class="messages">
                    {% for error in form.level.errors %}
                      <li class="error">{{ error }}</li>
                    {% endfor %}
                  </ul>
                {% endif %}
            </div>

            <div class="form__group" id="notes-field" style="display: none;">
              <label for="{{ form.notes.id_for_label }}">{{ form.notes.label }}</label>
              {{ form.notes }}
              {% if form.notes.errors %}
                <ul class="messages">
                  {% for error in form.notes.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <input
                type="text"
                name="referral_code_input"
                id="{{ form.referral_code_input.id_for_label }}"
                class="form-control"
                placeholder="Kod polecający"
                value="{{ form.referral_code_input.value|default_if_none:'' }}"
              >
               {% if form.referral_code_input.errors %}
                <ul class="messages">
                  {% for error in form.referral_code_input.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
               {% endif %}
              <small>{{ form.referral_code_input.help_text }}</small>
            </div>

            <div class="form__group">
              <div class="password-container">
                <input
                  type="password"
                  name="password1"
                  id="{{ form.password1.id_for_label }}"
                  class="form-control"
                  placeholder="{{ form.password1.label }}"
                >
              </div>
              {% if form.password1.errors %}
                <ul class="messages">
                  {% for error in form.password1.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <div class="password-container">
                <input
                  type="password"
                  name="password2"
                  id="{{ form.password2.id_for_label }}"
                  class="form-control"
                  placeholder="{{ form.password2.label }}"
                >
              </div>
              {% if form.password2.errors %}
                <ul class="messages">
                  {% for error in form.password2.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <label for="{{ form.terms_and_privacy.id_for_label }}">
                {{ form.terms_and_privacy }} Akceptuję
                <a href="{% static 'files/Regulamin.pdf' %}" target="_blank">Regulamin</a> oraz
                <a href="{% static 'files/Regulamin.pdf' %}" target="_blank">Politykę Prywatności</a>
              </label>
              {% if form.terms_and_privacy.errors %}
                <ul class="messages">
                  {% for error in form.terms_and_privacy.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <label for="{{ form.age_confirmation.id_for_label }}">
                {{ form.age_confirmation }}
                <span id="age-confirmation-text">
                  Potwierdzam ukończenie 18 lat.
                </span>
              </label>
              {% if form.age_confirmation.errors %}
                <ul class="messages">
                  {% for error in form.age_confirmation.errors %}
                    <li class="error">{{ error }}</li>
                  {% endfor %}
                </ul>
              {% endif %}
            </div>

            <div class="form__group">
              <div class="g-recaptcha" data-sitekey="6Ld1rU0rAAAAANPKXRZINCSKpLpy3HiPX5dbaLXn"></div>
            </div>

            <div class="container">
              <div class="center-button">
                <button class="btn btn--link" type="submit">
                  <span>Załóż konto</span>
                </button>
              </div>
            </div>
          </div>

        </form>
      </div>
    </div>
  </div>
</main>

<script src="{% static 'js/apply-user-tutoring-zone.js' %}"></script>
<script src="{% static 'js/password-visibility.js' %}"></script>

<script>
  document.addEventListener('DOMContentLoaded', function () {
    const role = document.getElementById('role-input').value;
    const notesField = document.getElementById('notes-field');

    if (role === 'student' && notesField) {
      notesField.style.display = 'block';
    } else if (notesField) {
      notesField.style.display = 'none';
    }
  });
</script>

{% endblock content %}
