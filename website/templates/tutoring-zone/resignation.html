{% extends 'base-tutoring-zone.html' %}
{% load static %}

{% block navbar %}
  {% include 'tutoring-zone/nav-teacher-view.html' %}
{% endblock navbar %}

{% block content %}
<main class="update-account layout">
    <div class="container">
        <div class="layout__box">
            <div class="layout__boxHeader">
                <div class="layout__boxTitle">
                    <a href="{% url 'schoolweb:user-profile' request.user.pk %}">
                        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32">
                            <title>Cofnij</title>
                            <path d="M13.723 2.286l-13.723 13.714 13.719 13.714
                            1.616-1.611-10.96-10.96h27.625v-2.286h-27.625l10.965-10.965-1.616-1.607z"></path>
                        </svg>
                    </a>
                    <h3>
                        {% if is_teacher %}
                            Formularz rezygnacji / przerwy (Nauczyciel)
                        {% else %}
                            Formularz rezygnacji (Uczeń)
                        {% endif %}
                    </h3>
                </div>
            </div>
            <div class="layout__body">
                <h2 class="auth__tagline" style="font-size:15px; text-align:left;">
                    {% if is_teacher %}
                        Dziękujemy za Twój wkład w nauczanie online na SchoolWeb. Szanujemy Twoją decyzję o przerwie lub zakończeniu współpracy.
                        Jeśli to możliwe, prosimy o znalezienie zastępstwa dla Twoich uczniów. Życzymy powodzenia!
                    {% else %}
                        Dziękujemy za korzystanie z platformy SchoolWeb. Jeśli zdecydowałeś/aś się na rezygnację, mamy nadzieję, że było to wartościowe doświadczenie.
                        Możesz wrócić w każdej chwili. Życzymy sukcesów w dalszej nauce!
                    {% endif %}
                    <br><br>
                    Pozdrawiamy,<br> Zespół SchoolWeb
                </h2>

                <form class="form" action="{% url 'schoolweb:resignation' %}" method="post" style="margin-top:35px;">
                    {% csrf_token %}

                    {% if is_teacher %}
                        <div class="form__group">
                            <label for="id_reason">Powód:</label>
                            {{ form.reason }}
                        </div>
                    {% endif %}

                    <div class="form__group" id="startEndDateGroup" style="display: none;">
                        <label for="resignation_start_date">Początkowa data przerwy:</label>
                        {{ form.pause_start_date }}
                    </div>

                    <div class="form__group" id="endDateGroup" style="display: none;">
                        <label for="resignation_end_date">Końcowa data przerwy:</label>
                        {{ form.pause_end_date }}
                    </div>

                    <div class="form__group" id="lastDayGroup" style="display: none;">
                        <label for="last_day">Ostatni dzień współpracy:</label>
                        {{ form.resignation_date }}
                    </div>

                    {% if is_teacher %}
                        <div class="form__group">
                            <label for="id_course_info">Informacje na temat kursów:</label>
                            {{ form.course_info }}
                        </div>
                    {% endif %}

                    <div class="form__group">
                        <label for="id_rating">Jak oceniasz platformę SchoolWeb:</label>
                        {{ form.rating }}
                    </div>

                    <div class="form__group">
                        <label for="id_consider_return">Czy rozważasz powrót na SchoolWeb?</label>
                        {{ form.consider_return }}
                    </div>

                    <div class="form__group">
                        <label for="id_reason_details">Dodatkowe informacje dotyczące powodu rezygnacji/przerwy:</label>
                        {{ form.reason_details }}
                    </div>

                    <div class="form__action">
                        <a class="btn btn--link" href="{{ request.META.HTTP_REFERER }}">Anuluj</a>
                        <button class="btn btn--link" type="submit">Zatwierdź</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</main>

<script>
document.addEventListener("DOMContentLoaded", function () {
    const reasonSelect = document.getElementById('id_reason');
    const startDateInput = document.getElementById('resignation_start_date');
    const endDateInput = document.getElementById('resignation_end_date');
    const lastDayInput = document.getElementById('last_day');

    const startEndDateGroup = document.getElementById('startEndDateGroup');
    const endDateGroup = document.getElementById('endDateGroup');
    const lastDayGroup = document.getElementById('lastDayGroup');

    function disableFutureDates() {
        const minDate = new Date();
        minDate.setDate(minDate.getDate() + 7);
        const min = minDate.toISOString().split('T')[0];

        if (startDateInput) startDateInput.min = min;
        if (endDateInput) endDateInput.min = min;
        if (lastDayInput) lastDayInput.min = min;
    }

    function handleReasonChange() {
        const selectedReason = reasonSelect ? reasonSelect.value : null;

        if (selectedReason === 'Przerwa') {
            startEndDateGroup.style.display = 'block';
            endDateGroup.style.display = 'block';
            lastDayGroup.style.display = 'none';
        } else if (selectedReason === 'Rezygnacja') {
            startEndDateGroup.style.display = 'none';
            endDateGroup.style.display = 'none';
            lastDayGroup.style.display = 'block';
        } else {
            startEndDateGroup.style.display = 'none';
            endDateGroup.style.display = 'none';
            lastDayGroup.style.display = 'none';
        }

        disableFutureDates();
    }

    if (reasonSelect) {
        reasonSelect.addEventListener('change', handleReasonChange);
        handleReasonChange();
    } else {
        disableFutureDates();
    }
});
</script>
{% endblock content %}
